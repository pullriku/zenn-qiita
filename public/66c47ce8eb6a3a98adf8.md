---
title: Pythonã§LINEã®å±¥æ­´ã‚’æ¤œç´¢ã™ã‚‹
tags:
  - Python
  - LINE
private: false
updated_at: '2023-11-30T19:57:23+09:00'
id: 66c47ce8eb6a3a98adf8
organization_url_name: null
slide: false
ignorePublish: false
---
## æ¦‚è¦
Pythonã‚’ç”¨ã„ã¦ï¼ŒLINEã‚¢ãƒ—ãƒªã‹ã‚‰å‡ºåŠ›ã§ãã‚‹`.txt`å½¢å¼ã®å±¥æ­´ã‚’æ¤œç´¢ã™ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ä½œæˆã—ã¾ã—ãŸï¼æ—¥ä»˜ã«ã‚ˆã‚‹æ¤œç´¢ï¼Œã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã«ã‚ˆã‚‹æ¤œç´¢ï¼Œã‚’å®Ÿè£…ã—ã¾ã—ãŸï¼iOS17.1.1ã§ï¼Œæ—¥æœ¬èªã®LINEã®å±¥æ­´ã‚’æƒ³å®šã—ã¦ã„ã¾ã™ï¼å®Ÿè£…ã®è§£èª¬ã‚’æ›¸ãã¾ã™ï¼

## ã¯ã˜ã‚ã«
LINEã®å±¥æ­´ãŒæ¶ˆãˆã¦ã—ã¾ã£ãŸéš›ã«ï¼Œç›¸æ‰‹ã«`.txt`ã‚’é€ã£ã¦ã‚‚ã‚‰ãˆã°ï¼Œéå»ã®ä¼šè©±ã‚’è¦‹ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼ã—ã‹ã—ï¼Œãã®å±¥æ­´ãŒé•·ã„å ´åˆã«ï¼Œæ‰‹å‹•ã§æ¤œç´¢ã™ã‚‹ã®ã¯å¤§å¤‰ã§ã™ï¼ãã“ã§ï¼ŒPythonã‚’ç”¨ã„ã¦ï¼Œå±¥æ­´ã‚’æ¤œç´¢ã™ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ä½œæˆã—ã¾ã—ãŸï¼

## å®Ÿè£…å‰ã®æº–å‚™
### Pythonã®ç¢ºèª

```zsh
% python3 --version
Python 3.11.6
```

### å±¥æ­´ãƒ•ã‚¡ã‚¤ãƒ«ã®å½¢å¼ã®ç¢ºèª
ã¾ãšï¼ŒLINEã‚¢ãƒ—ãƒªã‹ã‚‰å‡ºåŠ›ã§ãã‚‹`.txt`å½¢å¼ã®å±¥æ­´ã‚’ç¢ºèªã—ã¾ã™ï¼LINEã‚¢ãƒ—ãƒªã§ãƒˆãƒ¼ã‚¯ã‚’é–‹ãã€æ¨ªä¸‰æœ¬ç·šã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼â†’ã€Œè¨­å®šã€â†’ã€Œãƒˆãƒ¼ã‚¯å±¥æ­´ã‚’é€ä¿¡ã€ã‚’æŠ¼ã™ã¨ã€ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã§ãã¾ã™ã€‚

```txt
[LINE] ã‚°ãƒ«ãƒ¼ãƒ—åã®ãƒˆãƒ¼ã‚¯å±¥æ­´
ä¿å­˜æ—¥æ™‚ï¼š2023/02/13 00:00

2022/03/15(ç«)
01:01	Aã•ã‚“	ã‚ã„ã•ã¤
12:34	Bã•ã‚“	"ãŠã¯ã‚ˆã†
ã“ã‚“ã«ã¡ã¯
ã“ã‚“ã°ã‚“ã¯"

2022/06/02(é‡‘)
12:00	Cã•ã‚“	ã‚
12:00		Dã•ã‚“ãŒãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é€ä¿¡ã‚’å–ã‚Šæ¶ˆã—ã¾ã—ãŸ
```

æœ€åˆã®2è¡Œã«ã¯ï¼Œãƒˆãƒ¼ã‚¯åã¨ä¿å­˜æ—¥æ™‚ãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ï¼æ¬¡ã«æ”¹è¡ŒãŒã‚ã‚Šï¼Œãã®å¾Œã«æ—¥ä»˜ã”ã¨ã®ä¼šè©±ãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ï¼**æ—¥ä»˜ã¯æ˜‡é †ã«ä¸¦ã‚“ã§ã„ã¾ã™**ï¼ä¸€ç•ªä¸Šã®è¡Œã¯ï¼Œä¸€å¯¾ä¸€ã®ãƒˆãƒ¼ã‚¯ã®å ´åˆã«ã¯ï¼Œã€Œ`[LINE]__åå‰__ã¨ã®ãƒˆãƒ¼ã‚¯å±¥æ­´`ã€ï¼Œã‚°ãƒ«ãƒ¼ãƒ—ãƒˆãƒ¼ã‚¯ã®å ´åˆã«ã¯ï¼Œã€Œ`[LINE]__ã‚°ãƒ«ãƒ¼ãƒ—å__ã®ãƒˆãƒ¼ã‚¯å±¥æ­´`ã€ã¨ãªã‚Šã¾ã™ï¼**ã€Œã®ãƒˆãƒ¼ã‚¯å±¥æ­´ã€ãŒå…±é€šã—ã¦ã„ã¾ã™**ï¼

æ—¥ä»˜è¡¨ç¤ºã®å¾Œã«ã¯ï¼Œæ™‚åˆ»ï¼Œåå‰ï¼Œä¼šè©±å†…å®¹ãŒã‚¿ãƒ–åŒºåˆ‡ã‚Šã§è¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ï¼ç™ºè¨€ãŒè¤‡æ•°è¡Œã«æ¸¡ã‚‹å ´åˆã«ã¯ï¼Œãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã§å›²ã¾ã‚Œã¦ã„ã¾ã™ï¼é€ä¿¡å–ã‚Šæ¶ˆã—ã‚„é€€ä¼šãªã©ã®ã‚·ã‚¹ãƒ†ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ï¼Œåå‰ã®éƒ¨åˆ†ãŒã‚ã‚Šã¾ã›ã‚“ï¼ã™ãªã‚ã¡ï¼Œæ™‚åˆ»ã®å¾Œã«ã‚¿ãƒ–ãŒ2ã¤ã‚ã‚Šï¼Œãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ï¼

## å®Ÿè£…

### Historyã‚¯ãƒ©ã‚¹

#### å±æ€§ã¨åˆæœŸåŒ–å‡¦ç†
æ ¸ã¨ãªã‚‹`History`ã‚¯ãƒ©ã‚¹ã‚’ä½œæˆã—ã¾ã™ï¼
```python
class History:
    history_data: list[str]

    def __init__(self, data: str) -> None:
        lines = data.splitlines()

        if "ã®ãƒˆãƒ¼ã‚¯å±¥æ­´" in lines[0]:
            self.history_data = lines[3:]
        else:
            self.history_data = lines
```

`History`ã‚¯ãƒ©ã‚¹ã¯ï¼Œ`history_data`ã¨ã„ã†å±æ€§ã‚’æŒã¡ã¾ã™ï¼ã“ã‚Œã¯ï¼Œ`list[str]`å‹ã§ã™ï¼ã“ã‚Œã¯å±¥æ­´ã‚’è¡Œã”ã¨ã«åˆ†å‰²ã—ãŸã‚‚ã®ã§ã™ï¼

ã“ã®ã‚¯ãƒ©ã‚¹ã®åˆæœŸåŒ–ã‚’è¡Œã†`__init__`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®šç¾©ã—ã¾ã™ï¼ã“ã®ã‚¯ãƒ©ã‚¹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã™ã‚‹ã¨ï¼Œã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ãŒå‘¼ã³å‡ºã•ã‚Œã¾ã™ï¼
`str`å‹ã®å¼•æ•°`data`ã‚’å—ã‘å–ã‚Šï¼Œã“ã‚Œã‚’`.splitlines()`ã§è¡Œã”ã¨ã«åˆ†å‰²ã—ã¾ã™ï¼åˆ†å‰²ã—ãŸãƒ‡ãƒ¼ã‚¿ã«ï¼Œã€Œã®ãƒˆãƒ¼ã‚¯å±¥æ­´ã€ãŒå«ã¾ã‚Œã¦ã„ã‚‹å ´åˆã«ã¯ï¼Œãã®è¡Œã‚ˆã‚Šä¸Šã®3è¡Œã¯ä¸è¦ãªã®ã§ï¼Œ`self.history_data`ã«ã¯ï¼Œãã®3è¡Œã‚ˆã‚Šä¸‹ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä»£å…¥ã—ã¾ã™ï¼ãªã‚“ã‚‰ã‹ã®äº‹æƒ…ã§ï¼Œã€Œã®ãƒˆãƒ¼ã‚¯å±¥æ­´ã€ãŒå«ã¾ã‚Œã¦ã„ãªã„å ´åˆã«ã¯ï¼Œãã®ã¾ã¾`self.history_data`ã«ä»£å…¥ã—ã¾ã™ï¼

#### æ—¥ä»˜ã«ã‚ˆã‚‹æ¤œç´¢
ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®ä¸€ç•ªä¸Šã«ï¼Œimportæ–‡ã¨å®šæ•°ã‚’è¿½è¨˜ã—ã¾ã™ï¼
```python
import re
from datetime import datetime

DATE_PATTERN: str = r'^\d{4}/\d{2}/\d{2}\(.+\)$'
YMD_PATTERN: str = "%Y/%m/%d"
```
`re`ã¯ï¼Œæ­£è¦è¡¨ç¾ã‚’æ‰±ã†ãŸã‚ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ã™ï¼`datetime`ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯ï¼Œæ—¥ä»˜ã‚’æ‰±ã†ãŸã‚ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ã™ï¼
`DATE_PATTERN`ã¯ï¼Œæ—¥ä»˜ã‚’è¡¨ã™æ­£è¦è¡¨ç¾ã§ã™ï¼`YMD_PATTERN`ã¯ï¼Œæ—¥ä»˜ã‚’`datetime`å‹ã«å¤‰æ›ã™ã‚‹ãŸã‚ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§ã™ï¼ã®ã¡ã«ä½¿ã„ã¾ã™ï¼

æ—¥ä»˜ã«ã‚ˆã‚‹æ¤œç´¢ã‚’è¡Œã†`search_by_date`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’`History`ã‚¯ãƒ©ã‚¹ã«è¿½è¨˜ã—ã¾ã™ï¼ã™ãªã‚ã¡ï¼Œã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆï¼ˆå­—ä¸‹ã’ï¼‰ãŒå¿…è¦ã§ã™ï¼
```python
def search_by_date(self, date: datetime) -> str:
    target_date = date
    count_start: int = -1
    count_end: int = -1
    collect_flag: bool = False
    output: str = ""

    for i, line in enumerate(self.history_data):
        if not re.match(DATE_PATTERN, line):
            continue

        current_date = datetime.strptime(line[:10], YMD_PATTERN)

        if current_date == target_date:
            count_start = i
            collect_flag = True
        elif collect_flag and target_date < current_date:
            count_end = i-1
            break
    else:
        count_end = len(self.history_data)

    if count_start == -1:
        output = "There is no history of this date.\n"
    else:
        output += "\n".join(self.history_data[count_start:count_end])
        output += f"\n\n{count_end - count_start}è¡Œ\n"
    return output
```
æ—¥ä»˜ã‚’`datetime`å‹ã®å¼•æ•°`date`ã§å—ã‘å–ã‚Šã¾ã™ï¼`self`ã¯ï¼Œã“ã®ã‚¯ãƒ©ã‚¹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’æŒ‡ã—ï¼Œå‘¼ã³å‡ºã™éš›ã«ã¯ï¼Œå¼•æ•°ã‚’æŒ‡å®šã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ï¼
`target_date`ã¯ï¼Œæ¤œç´¢å¯¾è±¡ã®æ—¥ä»˜ã‚’è¡¨ã—ã¾ã™ï¼dateã®åå‰ã‚’å¤‰ãˆãŸã ã‘ã§ã™ï¼
`count_start`ã¯ï¼Œæ¤œç´¢å¯¾è±¡ã®æ—¥ä»˜ã®æœ€åˆã®è¡Œã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’è¡¨ã—ã¾ã™ï¼
`count_end`ã¯ï¼Œæ¤œç´¢å¯¾è±¡ã®æ—¥ä»˜ã®æœ€å¾Œã®è¡Œã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’è¡¨ã—ã¾ã™ï¼
`collect_flag`ã¯ï¼Œæ¤œç´¢å¯¾è±¡ã®æ—¥ä»˜ã®è¡Œã‚’é›†ã‚ã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’è¡¨ã—ã¾ã™ï¼
`output`ã¯ï¼Œæ¤œç´¢çµæœã‚’è¡¨ã—ã¾ã™ï¼

æ¬¡ã«ï¼Œ`for`æ–‡ã§`self.history_data`ã‚’èµ°æŸ»ã—ã¾ã™ï¼[1]
ã“ã®foræ–‡ã®ä¸­ã§ï¼Œ`count_start`ã¨`count_end`ã‚’æ±ºå®šã—ã¾ã™ï¼ã™ãªã‚ã¡ï¼Œæ¤œç´¢ã—ãŸã„ç¯„å›²ã®æœ€åˆã¨æœ€å¾Œã®è¡Œã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’æ±‚ã‚ã¾ã™ï¼
`enumerate`é–¢æ•°ã¯ï¼Œã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã¨è¡Œã®æ–‡å­—åˆ—ã‚’åŒæ™‚ã«å–å¾—ã§ãã¾ã™ï¼ãã‚Œãã‚Œã‚’`i`ã¨`line`ã¨ã—ã¾ã™ï¼

æ—¥ä»˜ã®å ´æ‰€ã ã‘ãŒåˆ†ã‹ã‚Œã°ã„ã„ã®ã§ï¼Œ`if`æ–‡ã§ï¼Œæ—¥ä»˜ã®è¡Œã‹ã©ã†ã‹ã‚’åˆ¤å®šã—ã¾ã™ï¼ãã‚Œã§ãªã„å ´åˆã¯ï¼Œ`continue`ã§æ¬¡ã®ãƒ«ãƒ¼ãƒ—ã«ç§»ã‚Šã¾ã™ï¼

æ—¥ä»˜ã®è¡Œã®å ´åˆã«ã¯ï¼Œ`datetime`å‹ã«å¤‰æ›ã—ã¦ï¼Œã“ã‚Œã‚’`current_date`ã¨ã—ã¾ã™ï¼
`current_date`ã¨`target_date`ãŒä¸€è‡´ã™ã‚‹å ´åˆã«ã¯ï¼Œã“ã®è¡ŒãŒæ¤œç´¢å¯¾è±¡ã®æ—¥ä»˜ã®æœ€åˆã®è¡Œã§ã‚ã‚‹ã¨ã„ã†ã“ã¨ã«ãªã‚Šã¾ã™ï¼ãã®ãŸã‚ï¼Œ`count_start`ã«`i`ã‚’ä»£å…¥ã—ï¼Œ`collect_flag`ã‚’`True`ã«ã—ã¾ã™ï¼

`collect_flag`ãŒ`True`ã®å ´åˆï¼Œã™ãªã‚ã¡æ¤œç´¢å¯¾è±¡ã®æ—¥ä»˜ã®æœ€åˆã®è¡Œã«åˆ°é”ã—ã¦ã„ã‚‹**ã‹ã¤**`target_date < current_date`[2]ã§ã‚ã‚‹å ´åˆã«ã¯ï¼Œã“ã®è¡ŒãŒæ¤œç´¢å¯¾è±¡ã®æ—¥ä»˜ã®ä¸€ã¤å¾Œã®æ—¥ä»˜ã®è¡Œã§ã‚ã‚‹ã¨ã„ã†ã“ã¨ã«ãªã‚Šã¾ã™ï¼ãã®ãŸã‚ï¼Œ`count_end`ã«`i-1`ã‚’ä»£å…¥ã—ï¼Œ`break`ã§ãƒ«ãƒ¼ãƒ—ã‚’æŠœã‘ã¾ã™ï¼

`for`ã¨åŒã˜å­—ä¸‹ã’ã®ä½ç½®ã«ã‚ã‚‹`else`ã«ã¤ã„ã¦ï¼Œ
`python
else:
        count_end = len(self.history_data)
`
ã“ã‚Œã¯ï¼Œ`for`ã«å¯¾ã—ã¦ã®ã‚‚ã®ã§ï¼Œif-elseã¨ã¯ç•°ãªã‚‹ã®ã§ï¼Œæ³¨æ„ã—ã¦ãã ã•ã„ï¼ã“ã‚Œã¯ï¼Œ`for`ãŒ`break`ã§æŠœã‘ãšã«çµ‚äº†ã—ãŸå ´åˆã«å®Ÿè¡Œã•ã‚Œï¼Œ`break`ãŒä½¿ç”¨ã•ã‚ŒãŸå ´åˆã«ã¯å®Ÿè¡Œã•ã‚Œã¾ã›ã‚“ï¼ã™ãªã‚ã¡ï¼Œæ¤œç´¢å¯¾è±¡ã®æ—¥ä»˜ã®æ¬¡ã®æ—¥ä»˜ãŒè¦‹ã¤ã‹ã‚‰ãªã„ã¾ã¾ï¼Œãƒ•ã‚¡ã‚¤ãƒ«ã®æœ€å¾Œã¾ã§åˆ°é”ã—ãŸå ´åˆã«ï¼Œ`count_end`ã«`len(self.history_data)`ã‚’ä»£å…¥ã™ã‚‹ã¨ã„ã†å‡¦ç†ã§ã™ï¼

æ¤œç´¢ã«ãƒ’ãƒƒãƒˆã—ãªã‹ã£ãŸå ´åˆã«ã¯ï¼Œ`count_start`ãŒ`-1`ã®ã¾ã¾ã§ã™ï¼ãã®å ´åˆã«ã¯ï¼Œ`output`ã«ã€Œæ¤œç´¢å¯¾è±¡ã®æ—¥ä»˜ã®å±¥æ­´ã¯ã‚ã‚Šã¾ã›ã‚“ã€ã¨ã„ã†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä»£å…¥ã—ã¾ã™ï¼[3]
ãƒ’ãƒƒãƒˆã—ãŸå ´åˆã«ã¯ï¼Œ`count_start`ã¨`count_end`ã®é–“ã®è¡Œï¼Œã™ãªã‚ã¡æ¤œç´¢å¯¾è±¡ã®æ—¥ä»˜ã®å±¥æ­´ã‚’`output`ã«ä»£å…¥ã—ã¾ã™ï¼ãã®å¾Œï¼Œè¡Œæ•°ã‚’`output`ã«è¿½åŠ ã—ã¾ã™ï¼

æœ€å¾Œã«`output`ã‚’è¿”ã—ã¾ã™ï¼

æ¬¡ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã«ã‚ˆã‚‹æ¤œç´¢ã‚’å®Ÿè£…ã™ã‚‹å‰ã«ï¼Œå…ˆã«[å®Ÿè¡Œ](#å®Ÿè¡Œ)ã«ã¦ï¼Œã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ï¼

#### ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã«ã‚ˆã‚‹æ¤œç´¢

ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã«ã‚ˆã‚‹æ¤œç´¢ã‚’è¡Œã†`search_by_keyword`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’`History`ã‚¯ãƒ©ã‚¹ã«è¿½è¨˜ã—ã¾ã™ï¼ã™ãªã‚ã¡ï¼Œã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆï¼ˆå­—ä¸‹ã’ï¼‰ãŒå¿…è¦ã§ã™ï¼
```python
def search_by_keyword(self, keyword: str) -> str:
    LOWER_LIMIT = 1
    if len(keyword) < LOWER_LIMIT:
        return "Please enter more than one character."

    count = 0
    output = ''
    max_date = datetime.min
    for line in self.history_data:
        if re.match(DATE_PATTERN, line):
            date = datetime.strptime(line[:10], YMD_PATTERN)
            if date >= max_date:
                max_date = date
        else:
            if not keyword in line:
                continue
            count += 1
            if re.match(r'^\d{2}:\d{2}.*', line):
                line = line[6:]
            if len(line) >= 61:
                line = line[:60] + 'â€¦'
            output += str(max_date)[:11].replace('-', '/') + " " + line + '\n'

    if output == '':
        output = 'Not found.'

    return f"{count}ä»¶\n{output}"
```
æ¤œç´¢ã—ãŸã„ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’`str`å‹ã®å¼•æ•°`keyword`ã§å—ã‘å–ã‚Šã¾ã™ï¼
`LOWER_LIMIT`ã¯ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã®æœ€ä½æ–‡å­—æ•°ã‚’è¡¨ã—ã¾ã™ï¼ä¾‹ãˆã°ï¼Œä¸€æ–‡å­—æ¤œç´¢ã¯å¤§é‡ã«ãƒ’ãƒƒãƒˆã—ã¦å‡¦ç†ãŒé…ã„ã®ã§ï¼Œã“ã‚Œã‚’ç¦æ­¢ã—ãŸã„å ´åˆã«ã¯ï¼Œ`LOWER_LIMIT = 2`ã¨ã—ã¾ã™ï¼ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã®æ–‡å­—æ•°ãŒ`LOWER_LIMIT`ã‚ˆã‚Šå°ã•ã„å ´åˆã«ã¯ï¼Œã€Œ1æ–‡å­—ä»¥ä¸Šå…¥åŠ›ã—ã¦ãã ã•ã„ã€ã¨ã„ã†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿”ã—ã¾ã™ï¼
`count`ã¯ãƒ’ãƒƒãƒˆã—ãŸè¡Œæ•°ã‚’è¡¨ã—ã¾ã™ï¼
`output`ã¯æ¤œç´¢çµæœã‚’è¡¨ã—ã¾ã™ï¼
`date`ã¯ç¾åœ¨å‚ç…§ã—ã¦ã„ã‚‹æ—¥ä»˜ã‚’è¡¨ã—ã¾ã™ï¼
`max_date`ã¯å‚ç…§ã—ãŸä¸­ã§ä¸€ç•ªå¤§ãã„æ—¥ä»˜ã‚’è¡¨ã—ã¾ã™ï¼

`for`æ–‡ã§`self.history_data`ã‚’èµ°æŸ»ã—ã¾ã™ï¼
ã“ã®foræ–‡ã®ä¸­ã§ï¼Œæ¤œç´¢çµæœã‚’`output`ã«è¿½åŠ ã—ã¦ã„ãï¼Œ
`line`ã¯ç¾åœ¨å‚ç…§ã—ã¦ã„ã‚‹è¡Œã®æ–‡å­—åˆ—ã§ã™ï¼
æ—¥ä»˜ã®è¡Œã®å ´åˆã«ï¼Œãã®æ—¥ä»˜ãŒ`max_date`ã‚ˆã‚Šå¤§ãã„å ´åˆã«ã¯ï¼Œ`date`ã¨`max_date`ã‚’æ›´æ–°ã—ã¾ã™ï¼
æ—¥ä»˜ã®è¡Œã§ãªã„å ´åˆã§ï¼Œ`keyword`ãŒ`line`ã«å«ã¾ã‚Œã¦ã„ãªã„å ´åˆã«ã¯ï¼Œæ¬¡ã®ãƒ«ãƒ¼ãƒ—ã«ç§»ã‚Šã¾ã™ï¼
`keyword`ãŒ`line`ã«å«ã¾ã‚Œã¦ã„ã‚‹å ´åˆã«ã¯ï¼Œ`count`ã‚’1å¢—ã‚„ã—ã¾ã™ï¼`line`ã®å…ˆé ­ã®æ™‚åˆ»ã‚’å‰Šé™¤ã—ï¼Œ`line`ã®æ–‡å­—æ•°ãŒ60æ–‡å­—ä»¥ä¸Šã®å ´åˆã«ã¯ï¼Œ61æ–‡å­—ç›®ä»¥é™ã‚’å‰Šé™¤ã—ã¾ã™ï¼ãã®å¾Œï¼Œ`output`ã«`line`ã‚’è¿½åŠ ã—ã¾ã™ï¼

æœ€çµ‚çš„ã«ï¼Œ`output`ãŒç©ºã®å ´åˆã«ã¯ï¼Œã€Œè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€ã¨ã„ã†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿”ã—ã¾ã™ï¼

ãã†ã§ãªã„å ´åˆã«ã¯ï¼Œ`count`ã‚’`output`ã®å…ˆé ­ã«è¿½åŠ ã—ã¦ï¼Œ`output`ã‚’è¿”ã—ã¾ã™ï¼


## å®Ÿè¡Œ
[å®Ÿè£…](#å®Ÿè£…)ã§ä½œæˆã—ãŸ`History`ã‚¯ãƒ©ã‚¹ã‚’å®Ÿéš›ã«å‹•ã‹ã—ã¾ã™ï¼
åŒã˜ãƒ•ã‚¡ã‚¤ãƒ«ã®æœ€ä¸‹éƒ¨[4]ã«ï¼Œä»¥ä¸‹ã‚’è¿½è¨˜ã—ã¾ã™ï¼`"history.txt"`ã®éƒ¨åˆ†ã¯ï¼Œæ¤œç´¢ã—ãŸã„å±¥æ­´ã®ãƒ•ã‚¡ã‚¤ãƒ«åã«å¤‰æ›´ã—ã¦ãã ã•ã„ï¼

2ã¤ã‚ã®`print`æ–‡ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚’å¤–ã™ï¼ˆ`#`ã‚’æ¶ˆã™ï¼‰ã¨ï¼Œã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã«ã‚ˆã‚‹æ¤œç´¢ã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã™ï¼
ä»¥ä¸‹ã¯`History`ã®ä¸­ã§ã¯ãªãï¼Œ`History`ã‚¯ãƒ©ã‚¹ã®ä¸‹ã«æ›¸ãã¾ã™ï¼
```python
def main() -> None:
    with open("history.txt", "r", encoding="utf-8") as f:
        history = History(f.read())

    # æ—¥ä»˜ã«ã‚ˆã‚‹æ¤œç´¢
    print(history.search_by_date(datetime(2022, 3, 15)))

    # ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã«ã‚ˆã‚‹æ¤œç´¢
    # print(history.search_by_keyword("ã“ã‚“ã«ã¡ã¯"))

if __name__ == "__main__":
    main()
```

## å…¨ä½“ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰
```python
import re
from datetime import datetime

DATE_PATTERN: str = r'^\d{4}/\d{2}/\d{2}\(.+\)$'
YMD_PATTERN: str = "%Y/%m/%d"

class History:
    history_data: list[str]

    def __init__(self, data: str) -> None:
        lines = data.splitlines()

        if "ã®ãƒˆãƒ¼ã‚¯å±¥æ­´" in lines[0]:
            self.history_data = lines[3:]
        else:
            self.history_data = lines

    def search_by_date(self, date: datetime) -> str:
        target_date = date
        count_start: int = -1
        count_end: int = -1
        collect_flag: bool = False
        output: str = ""

        for i, line in enumerate(self.history_data):
            if not re.match(DATE_PATTERN, line):
                continue

            current_date = datetime.strptime(line[:10], YMD_PATTERN)

            if current_date == target_date:
                count_start = i
                collect_flag = True
            elif collect_flag and target_date < current_date:
                count_end = i-1
                break
        else:
            count_end = len(self.history_data)

        if count_start == -1:
            output = "There is no history of this date.\n"
        else:
            output += "\n".join(self.history_data[count_start:count_end])
            output += f"\n\n{count_end - count_start}è¡Œ\n"
        return output

    def search_by_keyword(self, keyword: str) -> str:
        LOWER_LIMIT = 1
        if len(keyword) < LOWER_LIMIT:
            return "Please enter more than one character."

        count = 0
        output = ''
        max_date = datetime.min
        for line in self.history_data:
            if re.match(DATE_PATTERN, line):
                date = datetime.strptime(line[:10], YMD_PATTERN)
                if date >= max_date:
                    max_date = date
            else:
                if not keyword in line:
                    continue
                count += 1
                if re.match(r'^\d{2}:\d{2}.*', line):
                    line = line[6:]
                if len(line) >= 61:
                    line = line[:60] + 'â€¦'
                output += str(max_date)[:11].replace('-', '/') + " " + line + '\n'

        if output == '':
            output = 'Not found.'

        return f"{count}ä»¶\n{output}"

def main() -> None:
    with open("/Users/riku/Library/Mobile Documents/com~apple~CloudDocs/ğŸ¸GAshare/history.txt", "r", encoding="utf-8") as f:
        history = History(f.read())

    # æ—¥ä»˜ã«ã‚ˆã‚‹æ¤œç´¢
    print(history.search_by_date(datetime(2022, 3, 15)))

    # ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã«ã‚ˆã‚‹æ¤œç´¢
    # print(history.search_by_keyword("ã“ã‚“ã«ã¡ã¯"))

if __name__ == "__main__":
    main()
```

## ãŠã‚ã‚Šã«
LINEã®å±¥æ­´ã‚’æ¤œç´¢ã™ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ä½œæˆã—ã¾ã—ãŸï¼
ä»Šå›ä½œæˆã—ãŸãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯ï¼Œãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã—ã¦GitHubã«å…¬é–‹ã—ã¦ã„ã¾ã™ï¼

https://github.com/pullriku/linehistory



[1]: åˆæœŸåŒ–å‡¦ç†ã®æ™‚ç‚¹ã§ï¼Œæ—¥ä»˜ã¨è¡Œç•ªå·ã‚’å¯¾å¿œã•ã›ã‚‹dictã‚’ä½œæˆã—ã¦ãŠãï¼Œå±æ€§ã«å®šç¾©ã—ã¦ãŠãã¨ï¼Œã“ã®éƒ¨åˆ†ã¯ã‚ˆã‚Šå°‘ãªã„è¨ˆç®—é‡ã§å®Ÿè£…ã§ãã¾ã™ï¼ç°¡å˜ã®ãŸã‚ï¼Œä»Šå›ã¯å…¨æ¢ç´¢ã§å®Ÿè£…ã—ã¾ã™ï¼

[2]: ã“ã®æ¡ä»¶å¼ã¯ï¼Œæ¤œç´¢ç¯„å›²å†…ã«æ—¥ä»˜è¡¨ç¾ãŒã‚ã‚‹éš›ã«ï¼Œé–“é•ã£ã¦åå¿œã—ãªã„ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã®ã‚‚ã®ã§ã™ï¼æ¡ä»¶å¼ã‹ã‚‰åˆ†ã‹ã‚‹ã‚ˆã†ã«ï¼Œéå»ã®æ—¥ä»˜ã«ã¯åå¿œã—ã¾ã›ã‚“ãŒï¼Œæœªæ¥ã®æ—¥ä»˜ã«ã¯åå¿œã—ã¦ã—ã¾ã„ã¾ã™ï¼æ”¹å–„ã®ä½™åœ°ãŒã‚ã‚Šã¾ã™ï¼

[3]: ã‚¨ãƒ©ãƒ¼ã«ã—ãŸã‚Šï¼Œ`None`ã‚’è¿”ã—ãŸã‚Šã™ã‚‹æ–¹æ³•ã‚‚ã‚ã‚Šã¾ã™ï¼

[4]: å¿…è¦ã«å¿œã˜ã¦åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã«åˆ†ã‘ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ï¼ãã®å ´åˆã¯importæ–‡ã‚’è¿½è¨˜ã—ã¾ã™ï¼
